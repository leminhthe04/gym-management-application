// npx prisma migrate dev --name ten_thay_doi_cua_ban
// npx prisma generate

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Admin {
  id             Int      @id @default(autoincrement())
  username       String   @unique
  hashedPassword String
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  sessions Session[] // virtual field, it wont't create column in db
}

model Session {
  id        Int      @id @default(autoincrement())
  token     String   @unique // Refresh token string (opaque)
  expiresAt DateTime
  createdAt DateTime @default(now())

  // Quan hệ với Admin
  adminId Int
  admin   Admin @relation(fields: [adminId], references: [id], onDelete: Cascade)
}

model Member {
  id          Int     @id @default(autoincrement())
  code        String  @unique // Mã thẻ / Mã QR
  fullName    String
  phoneNumber String?

  // Dữ liệu AI (Lưu đường dẫn ảnh mẫu để train/compare)
  faceImageUrl     String?
  isFaceRegistered Boolean @default(false)

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  checkIns CheckIn[]
}

// --- BẢNG CHECK-IN (LỊCH SỬ RA VÀO) ---
model CheckIn {
  id          Int      @id @default(autoincrement())
  memberId    Int
  member      Member   @relation(fields: [memberId], references: [id])
  checkInTime DateTime @default(now())
  method      String   @default("FACE") // FACE, QR, MANUAL
  status      String   @default("SUCCESS") // SUCCESS, FAILED
}
